<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
  <title>DXB Gate Picker</title>

  <style>
    * { box-sizing: border-box; }

    body{
      margin:0; min-height:100vh; background:#1f9d55;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
      display:flex; align-items:center; justify-content:center; color:#fff;
    }

    .screen{
      width:100%;
      display:none;
    }
    .screen.active{ display:block; }

    .container{ width:100%; max-width:420px; padding:32px 24px 40px; text-align:center; margin:0 auto; }

    h1{ font-size:28px; margin:0 0 40px; font-weight:800; letter-spacing:.5px; }

    .result{
      font-size:92px; font-weight:400; line-height:1; letter-spacing:1px;
      display:inline-block; text-shadow:0 10px 28px rgba(0,0,0,.25);
    }

    @keyframes pop{
      0%{transform:translateY(18px) scale(.8);opacity:0}
      55%{transform:translateY(-10px) scale(1.25);opacity:1}
      80%{transform:translateY(4px) scale(.96)}
      100%{transform:translateY(0) scale(1)}
    }
    .pop{ animation:pop 460ms cubic-bezier(.2,.9,.2,1) both; }

    .btn{
      width:100%; border:none; border-radius:18px; background:#fff; cursor:pointer;
      box-shadow:0 7px 0 #148243;
      display:flex; align-items:center; justify-content:center;
      transition:transform .06s ease, box-shadow .06s ease, background-color .12s ease;
      -webkit-tap-highlight-color:transparent;
      position:relative; overflow:hidden;
    }
    .btn:active{
      transform:translateY(5px);
      box-shadow:0 2px 0 #148243;
      background-color:#e5e7eb;
    }
    .btn.pressed::after{ content:""; position:absolute; inset:0; background:rgba(0,0,0,.08); }

    #pickBtn{ margin-top:52px; height:88px; }
    #pickBtn svg{ width:46px; height:46px; stroke:#1f9d55; stroke-width:2.2; fill:none; }

    #mapBtn{
      margin-top:14px; height:62px; font-size:16px; font-weight:700;
      color:#1f9d55; letter-spacing:.2px;
    }
    #mapBtn svg{
      width:18px; height:18px; margin-right:10px; stroke:#1f9d55; stroke-width:2.2; fill:none;
    }

    /* Load button */
    #loadBtn{
      margin-top:14px; height:62px; font-size:16px; font-weight:800;
      color:#1f9d55; letter-spacing:.2px;
    }
    #loadBtn svg{
      width:18px; height:18px; margin-right:10px; stroke:#1f9d55; stroke-width:2.2; fill:none;
    }

    /* ---------- Fullscreen viewer (Maps) ---------- */
    .viewer{
      position:fixed; inset:0; background:#000; display:none; z-index:999;
      touch-action: pinch-zoom;
    }
    .viewer.show{ display:block; }

    .viewerHeader{
      position:absolute; top:0; left:0; right:0;
      padding:14px 14px 10px;
      display:flex; align-items:center; justify-content:space-between;
      z-index:3;
      background:linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,0));
    }
    .badge{
      font-size:13px; font-weight:700; color:rgba(255,255,255,.9);
      background:rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.18);
      padding:8px 10px; border-radius:999px;
      backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px);
      user-select:none;
    }
    .closeX{
      border:none; background:rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.18);
      border-radius:14px;
      width:44px; height:44px;
      display:grid; place-items:center;
      cursor:pointer;
      backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px);
      -webkit-tap-highlight-color:transparent;
    }
    .closeX svg{ width:22px; height:22px; stroke:#fff; stroke-width:2.4; fill:none; }

    .track{
      height:100%; width:100%;
      display:flex;
      transform:translateX(0);
      transition:transform 240ms ease;
      will-change:transform;
      touch-action: pan-y pinch-zoom;
    }

    .slide{
      min-width:100%;
      height:100%;
      display:grid;
      place-items:center;
      padding:64px 10px 18px;
      user-select:none;
    }

    .slide img{
      max-width:100%;
      max-height:calc(100vh - 90px);
      object-fit:contain;
      display:block;
      -webkit-user-drag:none;
      user-select:none;
      pointer-events:auto;
      touch-action: pinch-zoom;
    }

    .dots{
      position:absolute; left:0; right:0; bottom:14px;
      display:flex; justify-content:center; gap:8px;
      z-index:3; pointer-events:none;
    }
    .dot{ width:7px; height:7px; border-radius:999px; background:rgba(255,255,255,.35); }
    .dot.active{ background:rgba(255,255,255,.92); }

    /* ---------- Load Screen ---------- */
    .loadHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin:0 0 18px;
    }
    .loadTitle{
      font-size:24px;
      font-weight:900;
      letter-spacing:.2px;
      margin:0;
      text-align:left;
      flex:1;
    }
    .iconBtn{
      width:44px; height:44px;
      border:none;
      border-radius:14px;
      background:rgba(255,255,255,0.16);
      border:1px solid rgba(255,255,255,0.22);
      display:grid; place-items:center;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .iconBtn:active{ transform: scale(0.98); }
    .iconBtn svg{ width:22px; height:22px; stroke:#fff; stroke-width:2.4; fill:none; opacity:0.95; }

    .panel{
      width:100%;
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 18px;
      padding: 14px;
      text-align:left;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .label{
      font-size:12px;
      font-weight:800;
      letter-spacing:0.5px;
      opacity:0.9;
      margin:0 0 8px;
      text-transform: uppercase;
    }

    select{
      width:100%;
      height:48px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.22);
      background: rgba(0,0,0,0.18);
      color:#fff;
      font-size:15px;
      padding: 0 12px;
      outline:none;
      appearance:none;
    }

    .table{
      margin-top: 14px;
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.18);
    }

    .table th, .table td{
      padding: 12px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.14);
      font-size: 15px;
    }

    .table th{
      text-align:left;
      font-weight:900;
      background: rgba(0,0,0,0.14);
    }

    .table td:last-child, .table th:last-child{
      text-align:right;
      font-variant-numeric: tabular-nums;
    }

    .table tr:last-child td{ border-bottom:none; }

    .subhint{
      margin: 10px 2px 0;
      font-size: 12px;
      opacity: 0.85;
      line-height: 1.35;
    }

    @media (prefers-reduced-motion: reduce){
      .track{ transition:none; }
      .pop{ animation:none; }
    }
  </style>
</head>

<body>

  <!-- ================= MAIN SCREEN ================= -->
  <div id="screenMain" class="screen active">
    <div class="container">
      <h1>DXB Gate Picker</h1>

      <div class="result" id="result">—</div>

      <button id="pickBtn" class="btn" type="button" aria-label="Generate Gate">
        <!-- generate/refresh icon -->
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M21 12a9 9 0 1 1-2.64-6.36"/>
          <polyline points="21 3 21 9 15 9"/>
        </svg>
      </button>

      <button id="mapBtn" class="btn" type="button" aria-label="View Map">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M3 6l6-2 6 2 6-2v14l-6 2-6-2-6 2V6z"/>
          <path d="M9 4v14M15 6v14"/>
        </svg>
        View Map
      </button>

      <button id="loadBtn" class="btn" type="button" aria-label="Load">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 3v10"/>
          <path d="M8.5 6.5L12 3l3.5 3.5"/>
          <path d="M4 14h16v6H4z"/>
        </svg>
        Load
      </button>
    </div>
  </div>

  <!-- ================= LOAD SCREEN ================= -->
  <div id="screenLoad" class="screen">
    <div class="container">
      <div class="loadHeader">
        <h2 class="loadTitle">Load</h2>

        <!-- Refresh (top-right) -->
        <button id="loadRefreshBtn" class="iconBtn" type="button" aria-label="Refresh Load">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M21 12a9 9 0 1 1-2.64-6.36"/>
            <polyline points="21 3 21 9 15 9"/>
          </svg>
        </button>
      </div>

      <div class="panel">
        <div class="label">Aircraft</div>
        <select id="aircraftSelect" aria-label="Select Aircraft"></select>

        <table class="table" id="loadTable" aria-label="Load table">
          <thead>
            <tr>
              <th>Class</th>
              <th>Load</th>
            </tr>
          </thead>
          <tbody id="loadTbody"></tbody>
        </table>

        <p class="subhint">Refresh 아이콘을 누르면 동일 기종 기준으로 로드(탑승 수)가 다시 랜덤 생성됩니다.</p>
      </div>
    </div>
  </div>

  <!-- ================= MAP VIEWER ================= -->
  <div id="viewer" class="viewer" role="dialog" aria-modal="true" aria-label="Maps">
    <div class="viewerHeader">
      <div id="badge" class="badge">1 / 2</div>
      <button id="closeViewer" class="closeX" type="button" aria-label="Close">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M6 6l12 12M18 6L6 18"/>
        </svg>
      </button>
    </div>

    <div id="track" class="track">
      <!-- 루트에 h1.png, h2.png 업로드 -->
      <div class="slide"><img src="h1.png" alt="h1 map" draggable="false" /></div>
      <div class="slide"><img src="h2.png" alt="h2 map" draggable="false" /></div>
    </div>

    <div class="dots" aria-hidden="true">
      <div class="dot" id="dot0"></div>
      <div class="dot" id="dot1"></div>
    </div>
  </div>

  <script>
    /* ---------- Press feedback ---------- */
    const addPressFeedback = (btn) => {
      const on = () => btn.classList.add('pressed');
      const off = () => btn.classList.remove('pressed');
      btn.addEventListener('pointerdown', on);
      btn.addEventListener('pointerup', off);
      btn.addEventListener('pointerleave', off);
      btn.addEventListener('pointercancel', off);
    };

    /* ---------- Screen nav (SPA) ---------- */
    const screenMain = document.getElementById('screenMain');
    const screenLoad = document.getElementById('screenLoad');

    const showScreen = (name) => {
      const isMain = name === 'main';
      screenMain.classList.toggle('active', isMain);
      screenLoad.classList.toggle('active', !isMain);
    };

    /* ---------- Gate logic ---------- */
    const range = (p, s, e, ex = new Set()) => {
      const a = [];
      for (let i = s; i <= e; i++) {
        const v = `${p}${i}`;
        if (!ex.has(v)) a.push(v);
      }
      return a;
    };

    const poolA = range("A", 1, 24, new Set(["A6","A7","A18","A19"]));
    const poolB = range("B", 6, 32, new Set(["B7","B16"]));
    // C37~C46 삭제 반영: C1~C23(단 C15 제외)만 사용
    const poolC = range("C", 1, 23, new Set(["C15"]));
    const pools = { A: poolA, B: poolB, C: poolC, Remote: ["Remote"] };

    const pickCategory = () => {
      const r = Math.random() * 100;
      if (r < 30) return "A";
      if (r < 60) return "B";
      if (r < 90) return "C";
      return "Remote";
    };
    const pickOne = (a) => a[Math.floor(Math.random() * a.length)];
    const haptic = () => { if (navigator.vibrate) navigator.vibrate([20,12,20]); };

    const resultEl = document.getElementById('result');
    const pickBtn = document.getElementById('pickBtn');
    const mapBtn  = document.getElementById('mapBtn');
    const loadBtn = document.getElementById('loadBtn');

    addPressFeedback(pickBtn);
    addPressFeedback(mapBtn);
    addPressFeedback(loadBtn);

    const playPop = () => {
      resultEl.classList.remove('pop');
      void resultEl.offsetWidth;
      resultEl.classList.add('pop');
    };

    pickBtn.addEventListener('click', () => {
      haptic();
      resultEl.textContent = pickOne(pools[pickCategory()]);
      playPop();
    });

    /* ---------- Maps viewer + swipe (핀치 줌과 공존) ---------- */
    const viewer = document.getElementById('viewer');
    const closeViewer = document.getElementById('closeViewer');
    const track = document.getElementById('track');
    const badge = document.getElementById('badge');
    const dots = [document.getElementById('dot0'), document.getElementById('dot1')];

    const slideCount = 2;
    let mapIndex = 0;

    const setMapIndex = (i, animate = true) => {
      mapIndex = Math.max(0, Math.min(slideCount - 1, i));
      track.style.transition = animate ? 'transform 240ms ease' : 'none';
      track.style.transform = `translateX(${-mapIndex * 100}%)`;
      badge.textContent = `${mapIndex + 1} / ${slideCount}`;
      dots.forEach((d, idx) => d.classList.toggle('active', idx === mapIndex));
    };

    const openViewer = () => {
      viewer.classList.add('show');
      document.body.style.overflow = 'hidden';
      setMapIndex(0, false);
    };
    const closeViewerFn = () => {
      viewer.classList.remove('show');
      document.body.style.overflow = '';
    };

    mapBtn.addEventListener('click', openViewer);
    closeViewer.addEventListener('click', closeViewerFn);

    const activePointers = new Map();
    let startX = 0, dx = 0, swiping = false;
    const vw = () => Math.max(1, window.innerWidth || 375);

    track.addEventListener('pointerdown', (e) => {
      if (!viewer.classList.contains('show')) return;
      activePointers.set(e.pointerId, { x: e.clientX, y: e.clientY });

      if (activePointers.size === 1) {
        swiping = true; startX = e.clientX; dx = 0;
        track.style.transition = 'none';
      } else {
        swiping = false;
      }
      track.setPointerCapture(e.pointerId);
    });

    track.addEventListener('pointermove', (e) => {
      if (!activePointers.has(e.pointerId)) return;
      activePointers.set(e.pointerId, { x: e.clientX, y: e.clientY });

      if (!swiping || activePointers.size !== 1) return;
      dx = e.clientX - startX;
      const base = -mapIndex * vw();
      track.style.transform = `translateX(${base + dx}px)`;
    });

    const endSwipe = () => {
      if (!swiping) return;
      swiping = false;
      const threshold = Math.min(90, vw() * 0.22);
      if (dx > threshold) setMapIndex(mapIndex - 1, true);
      else if (dx < -threshold) setMapIndex(mapIndex + 1, true);
      else setMapIndex(mapIndex, true);
      dx = 0;
    };

    const onPointerUpOrCancel = (e) => {
      if (activePointers.has(e.pointerId)) activePointers.delete(e.pointerId);
      if (activePointers.size === 0) endSwipe();
      if (activePointers.size === 1) swiping = false;
    };

    track.addEventListener('pointerup', onPointerUpOrCancel);
    track.addEventListener('pointercancel', onPointerUpOrCancel);

    setMapIndex(0, false);

    /* ---------- Load screen logic ---------- */
    const aircraftSelect = document.getElementById('aircraftSelect');
    const loadTbody = document.getElementById('loadTbody');
    const loadRefreshBtn = document.getElementById('loadRefreshBtn');

    // Data: capacities per class. Arrays mean config-dependent capacity (choose one randomly per refresh).
    const aircraftData = [
      { name: "A350-900", classes: { C: 32, W: 21, Y: 259 } },
      { name: "A350-900 ULR", classes: { C: 32, W: 21, Y: 238 } },
      { name: "A380 Two Class", classes: { C: 58, Y: 557 } },
      { name: "A380 Three Class Medium Range", classes: { F: 14, C: 76, Y: [427, 429] } },
      { name: "A380 Three Class Long Range", classes: { F: 14, C: 76, Y: [399, 401] } },
      { name: "A380 Four Class", classes: { F: 14, C: 76, W: 56, Y: [322, 338, 341] } },
      { name: "B777-200LR", classes: { C: 38, Y: 264 } },
      { name: "B777-300ER Two Class", classes: { C: 35, Y: 386 } },
      { name: "B777-300ER Three Class", classes: { F: 8, C: 42, Y: [304, 310] } },
      { name: "B777-300ER Four Class", classes: { F: 8, C: 42, W: 24, Y: [256, 260] } },
      { name: "B777-300ER Game Changer", classes: { F: 6, C: 40, W: 24, Y: 256 } }
    ];

    const classOrder = ["F", "C", "W", "Y"];
    const className = { F: "F", C: "C", W: "W", Y: "Y" };

    const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const pickCap = (v) => Array.isArray(v) ? v[randInt(0, v.length - 1)] : v;

    const renderLoad = () => {
      const idx = aircraftSelect.selectedIndex;
      const aircraft = aircraftData[Math.max(0, idx)];
      if (!aircraft) return;

      // Pick capacities (including random config choices)
      const caps = {};
      for (const k of Object.keys(aircraft.classes)) {
        caps[k] = pickCap(aircraft.classes[k]);
      }

      // Random loads
      const loads = {};
      for (const k of Object.keys(caps)) {
        loads[k] = randInt(0, caps[k]);
      }

      // Build table
      loadTbody.innerHTML = "";
      for (const cls of classOrder) {
        if (!(cls in caps)) continue;

        const tr = document.createElement("tr");
        const td1 = document.createElement("td");
        const td2 = document.createElement("td");

        td1.textContent = className[cls];
        td2.textContent = `${loads[cls]}/${caps[cls]}`;

        tr.appendChild(td1);
        tr.appendChild(td2);
        loadTbody.appendChild(tr);
      }
    };

    // Populate dropdown
    const initAircraftSelect = () => {
      aircraftSelect.innerHTML = "";
      for (const a of aircraftData) {
        const opt = document.createElement("option");
        opt.value = a.name;
        opt.textContent = a.name;
        aircraftSelect.appendChild(opt);
      }
      aircraftSelect.selectedIndex = 0;
      renderLoad();
    };

    addPressFeedback(loadRefreshBtn);

    aircraftSelect.addEventListener("change", renderLoad);
    loadRefreshBtn.addEventListener("click", renderLoad);

    // Navigate to Load screen
    loadBtn.addEventListener("click", () => {
      showScreen('load');
      // 최초 1회 초기화
      if (aircraftSelect.options.length === 0) initAircraftSelect();
      else renderLoad();
    });

    // Optional: browser back to return main (simple)
    // 사용자가 뒤로가기를 누를 때 메인으로 보이게 하고 싶다면 아래를 활성화하세요.
    // window.addEventListener('popstate', () => showScreen('main'));
  </script>
</body>
</html>
