<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
  <title>DXB Gate Picker</title>

  <style>
    * { box-sizing: border-box; }

    body{
      margin:0; min-height:100vh; background:#1f9d55;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
      display:flex; align-items:center; justify-content:center; color:#fff;
    }

    .screen{ width:100%; display:none; }
    .screen.active{ display:block; }

    .container{ width:100%; max-width:420px; padding:32px 24px 40px; text-align:center; margin:0 auto; }

    h1{ font-size:28px; margin:0 0 40px; font-weight:800; letter-spacing:.5px; }

    .result{
      font-size:92px; font-weight:400; line-height:1; letter-spacing:1px;
      display:inline-block; text-shadow:0 10px 28px rgba(0,0,0,.25);
    }

    @keyframes pop{
      0%{transform:translateY(18px) scale(.8);opacity:0}
      55%{transform:translateY(-10px) scale(1.25);opacity:1}
      80%{transform:translateY(4px) scale(.96)}
      100%{transform:translateY(0) scale(1)}
    }
    .pop{ animation:pop 460ms cubic-bezier(.2,.9,.2,1) both; }

    .btn{
      width:100%; border:none; border-radius:18px; background:#fff; cursor:pointer;
      box-shadow:0 7px 0 #148243;
      display:flex; align-items:center; justify-content:center;
      transition:transform .06s ease, box-shadow .06s ease, background-color .12s ease;
      -webkit-tap-highlight-color:transparent;
      position:relative; overflow:hidden;
    }
    .btn:active{
      transform:translateY(5px);
      box-shadow:0 2px 0 #148243;
      background-color:#e5e7eb;
    }
    .btn.pressed::after{ content:""; position:absolute; inset:0; background:rgba(0,0,0,.08); }

    #pickBtn{ margin-top:52px; height:88px; }
    #pickBtn svg{ width:46px; height:46px; stroke:#1f9d55; stroke-width:2.2; fill:none; }

    #mapBtn, #loadBtn{
      margin-top:14px; height:62px; font-size:16px; font-weight:800;
      color:#1f9d55; letter-spacing:.2px;
    }
    #mapBtn svg, #loadBtn svg{
      width:20px; height:20px; margin-right:10px; stroke:#1f9d55; stroke-width:2.2; fill:none;
    }

    /* ---------- Fullscreen viewer (Maps) ---------- */
    .viewer{
      position:fixed; inset:0; background:#000; display:none; z-index:999;
      touch-action: pinch-zoom;
    }
    .viewer.show{ display:block; }

    .viewerHeader{
      position:absolute; top:0; left:0; right:0;
      padding:14px 14px 10px;
      display:flex; align-items:center; justify-content:space-between;
      z-index:3;
      background:linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,0));
    }
    .badge{
      font-size:13px; font-weight:700; color:rgba(255,255,255,.9);
      background:rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.18);
      padding:8px 10px; border-radius:999px;
      backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px);
      user-select:none;
    }
    .closeX{
      border:none; background:rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.18);
      border-radius:14px;
      width:44px; height:44px;
      display:grid; place-items:center;
      cursor:pointer;
      backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px);
      -webkit-tap-highlight-color:transparent;
    }
    .closeX svg{ width:22px; height:22px; stroke:#fff; stroke-width:2.4; fill:none; }

    .track{
      height:100%; width:100%;
      display:flex;
      transform:translateX(0);
      transition:transform 240ms ease;
      will-change:transform;
      touch-action: pan-y pinch-zoom;
    }
    .slide{
      min-width:100%;
      height:100%;
      display:grid;
      place-items:center;
      padding:64px 10px 18px;
      user-select:none;
    }
    .slide img{
      max-width:100%;
      max-height:calc(100vh - 90px);
      object-fit:contain;
      display:block;
      -webkit-user-drag:none;
      user-select:none;
      pointer-events:auto;
      touch-action: pinch-zoom;
    }
    .dots{
      position:absolute; left:0; right:0; bottom:14px;
      display:flex; justify-content:center; gap:8px;
      z-index:3; pointer-events:none;
    }
    .dot{ width:7px; height:7px; border-radius:999px; background:rgba(255,255,255,.35); }
    .dot.active{ background:rgba(255,255,255,.92); }

    /* ---------- Load Screen (Full-bleed White) ---------- */
    #screenLoad{
      position:fixed;
      inset:0;
      background:#ffffff;
      color:#000;
      z-index:20;
      overflow:auto;
      -webkit-overflow-scrolling:touch;
    }
    #screenLoad .container{
      color:#000;
      max-width:420px;
      margin:0 auto;
      padding:24px 18px 40px;
      text-align:center;
    }

    .loadHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin:0 0 16px;
    }
    .leftControls{
      display:flex;
      align-items:center;
      gap:10px;
      flex:1;
      min-width:0;
    }

    .homeBtn, .iconBtn{
      width:44px; height:44px;
      border:none;
      border-radius:14px;
      background:#ffffff;
      border:1px solid rgba(0,0,0,0.16);
      display:grid; place-items:center;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
      box-shadow: 0 6px 16px rgba(0,0,0,0.08);
      flex:0 0 auto;
    }
    .homeBtn:active, .iconBtn:active{ transform: scale(0.98); }
    .homeBtn svg, .iconBtn svg{
      width:22px; height:22px;
      stroke:#111; stroke-width:2.4; fill:none;
      opacity:0.95;
    }

    .loadTitle{
      font-size:24px;
      font-weight:900;
      letter-spacing:.2px;
      margin:0;
      text-align:left;
      flex:1;
      min-width:0;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      color:#000;
    }

    .panel{
      width:100%;
      background:#ffffff;
      border: 1px solid rgba(0,0,0,0.12);
      border-radius: 18px;
      padding: 14px;
      text-align:left;
      box-shadow: 0 10px 26px rgba(0,0,0,0.08);
    }

    .label{
      font-size:12px;
      font-weight:800;
      letter-spacing:0.5px;
      opacity:0.9;
      margin:0 0 8px;
      text-transform: uppercase;
      color:#111;
    }

    .selectWrap{ position:relative; }
    .chev{
      position:absolute;
      right:12px;
      top:50%;
      transform:translateY(-50%);
      width:18px; height:18px;
      stroke:rgba(0,0,0,0.72);
      stroke-width:2.6;
      fill:none;
      pointer-events:none;
      opacity:0.95;
    }

    select{
      width:100%;
      height:48px;
      border-radius:14px;
      border:1px solid rgba(0,0,0,0.16);
      background:#fff;
      color:#000;
      font-size:15px;
      padding: 0 44px 0 12px;
      outline:none;
      appearance:none;
      -webkit-appearance:none;
    }

    /* ✅ 표의 "Class ↔ Load" 간격 축소: 첫 컬럼 폭 축소 + 패딩 축소 + auto 레이아웃 */
    .table{
      margin-top: 14px;
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,0.12);
      table-layout: auto;
      color:#000;
    }

    .table th, .table td{
      padding: 9px 8px; /* 기존보다 좌우 패딩 축소 */
      border-bottom: 1px solid rgba(0,0,0,0.08);
      font-size: 15px;
    }

    .table th{
      text-align:left;
      font-weight:900;
      background: rgba(0,0,0,0.04);
      color:#000;
    }

    /* 첫 컬럼을 좁게 */
    .table td:first-child, .table th:first-child{
      width: 22%;
      padding-right: 6px; /* Class-Load 사이 간격 더 축소 */
    }
    .table td:last-child, .table th:last-child{
      width: 78%;
      text-align:right;
      font-variant-numeric: tabular-nums;
      padding-left: 6px;
      color: inherit; /* ✅ 행 색상이 로드 숫자에도 적용되도록 */
    }
    .table tr:last-child td{ border-bottom:none; }

    /* ✅ 클래스 글자 굵게 */
    .clsCell{ font-weight:900; }

    /* ✅ 행 단위로 "클래스 + 로드" 모두 색상 적용 */
    .rowF td{ color:#8b0000; } /* 진한 빨간색 */
    .rowC td{ color:#0b2a6f; } /* 남색 */
    .rowW td{ color:#6b21a8; } /* 보라색 */
    .rowY td{ color:#0f7a2a; } /* 초록색 */

    .totalRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-top: 12px;
      padding: 12px 10px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,0.12);
      background: rgba(0,0,0,0.04);
      font-size: 15px;
      font-variant-numeric: tabular-nums;
      color:#000;
    }
    .totalLeft{ font-weight:900; letter-spacing:0.2px; }
    .totalRight{ text-align:right; white-space:nowrap; }

    @media (prefers-reduced-motion: reduce){
      .track{ transition:none; }
      .pop{ animation:none; }
    }
  </style>
</head>

<body>

  <!-- ================= MAIN SCREEN ================= -->
  <div id="screenMain" class="screen active">
    <div class="container">
      <h1>DXB Gate Picker</h1>

      <div class="result" id="result">—</div>

      <button id="pickBtn" class="btn" type="button" aria-label="Generate Gate">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M21 12a9 9 0 1 1-2.64-6.36"/>
          <polyline points="21 3 21 9 15 9"/>
        </svg>
      </button>

      <button id="mapBtn" class="btn" type="button" aria-label="View Map">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M3 6l6-2 6 2 6-2v14l-6 2-6-2-6 2V6z"/>
          <path d="M9 4v14M15 6v14"/>
        </svg>
        View Map
      </button>

      <button id="loadBtn" class="btn" type="button" aria-label="Load">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M7 13V6a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v7"/>
          <path d="M5 13h14v3a3 3 0 0 1-3 3H8a3 3 0 0 1-3-3v-3z"/>
          <path d="M6 19v2M18 19v2"/>
        </svg>
        Load
      </button>
    </div>
  </div>

  <!-- ================= LOAD SCREEN ================= -->
  <div id="screenLoad" class="screen" aria-hidden="true">
    <div class="container">
      <div class="loadHeader">
        <div class="leftControls">
          <button id="homeBtn" class="homeBtn" type="button" aria-label="Back to Home">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M10 19l-7-7 7-7"/>
              <path d="M3 12h18"/>
            </svg>
          </button>
          <h2 class="loadTitle">Load</h2>
        </div>

        <button id="loadRefreshBtn" class="iconBtn" type="button" aria-label="Refresh Load">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M21 12a9 9 0 1 1-2.64-6.36"/>
            <polyline points="21 3 21 9 15 9"/>
          </svg>
        </button>
      </div>

      <div class="panel">
        <div class="label">Aircraft</div>

        <div class="selectWrap">
          <select id="aircraftSelect" aria-label="Select Aircraft"></select>
          <svg class="chev" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M6 9l6 6 6-6"/>
          </svg>
        </div>

        <table class="table" id="loadTable" aria-label="Load table">
          <thead>
            <tr>
              <th>Class</th>
              <th>Load</th>
            </tr>
          </thead>
          <tbody id="loadTbody"></tbody>
        </table>

        <div class="totalRow" aria-label="Total load">
          <div class="totalLeft">Total</div>
          <div class="totalRight" id="totalText">—</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ================= MAP VIEWER ================= -->
  <div id="viewer" class="viewer" role="dialog" aria-modal="true" aria-label="Maps">
    <div class="viewerHeader">
      <div id="badge" class="badge">1 / 2</div>
      <button id="closeViewer" class="closeX" type="button" aria-label="Close">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M6 6l12 12M18 6L6 18"/>
        </svg>
      </button>
    </div>

    <div id="track" class="track">
      <div class="slide"><img src="h1.png" alt="h1 map" draggable="false" /></div>
      <div class="slide"><img src="h2.png" alt="h2 map" draggable="false" /></div>
    </div>

    <div class="dots" aria-hidden="true">
      <div class="dot" id="dot0"></div>
      <div class="dot" id="dot1"></div>
    </div>
  </div>

  <script>
    const addPressFeedback = (btn) => {
      const on = () => btn.classList.add('pressed');
      const off = () => btn.classList.remove('pressed');
      btn.addEventListener('pointerdown', on);
      btn.addEventListener('pointerup', off);
      btn.addEventListener('pointerleave', off);
      btn.addEventListener('pointercancel', off);
    };

    const screenMain = document.getElementById('screenMain');
    const screenLoad = document.getElementById('screenLoad');

    const showScreen = (name) => {
      const isMain = name === 'main';
      screenMain.classList.toggle('active', isMain);
      screenLoad.classList.toggle('active', !isMain);
      screenLoad.setAttribute('aria-hidden', String(isMain));
      if (!isMain) screenLoad.scrollTop = 0;
    };

    /* ---------- Gate logic ---------- */
    const range = (p, s, e, ex = new Set()) => {
      const a = [];
      for (let i = s; i <= e; i++) {
        const v = `${p}${i}`;
        if (!ex.has(v)) a.push(v);
      }
      return a;
    };

    const poolA = range("A", 1, 24, new Set(["A6","A7","A18","A19"]));
    const poolB = range("B", 6, 32, new Set(["B7","B16"]));
    const poolC = range("C", 1, 23, new Set(["C15"]));
    const pools = { A: poolA, B: poolB, C: poolC, Remote: ["Remote"] };

    const pickCategory = () => {
      const r = Math.random() * 100;
      if (r < 30) return "A";
      if (r < 60) return "B";
      if (r < 90) return "C";
      return "Remote";
    };
    const pickOne = (a) => a[Math.floor(Math.random() * a.length)];
    const haptic = () => { if (navigator.vibrate) navigator.vibrate([20,12,20]); };

    const resultEl = document.getElementById('result');
    const pickBtn = document.getElementById('pickBtn');
    const mapBtn  = document.getElementById('mapBtn');
    const loadBtn = document.getElementById('loadBtn');

    addPressFeedback(pickBtn);
    addPressFeedback(mapBtn);
    addPressFeedback(loadBtn);

    const playPop = () => {
      resultEl.classList.remove('pop');
      void resultEl.offsetWidth;
      resultEl.classList.add('pop');
    };

    pickBtn.addEventListener('click', () => {
      haptic();
      resultEl.textContent = pickOne(pools[pickCategory()]);
      playPop();
    });

    /* ---------- Maps viewer + swipe ---------- */
    const viewer = document.getElementById('viewer');
    const closeViewer = document.getElementById('closeViewer');
    const track = document.getElementById('track');
    const badge = document.getElementById('badge');
    const dots = [document.getElementById('dot0'), document.getElementById('dot1')];

    const slideCount = 2;
    let mapIndex = 0;

    const setMapIndex = (i, animate = true) => {
      mapIndex = Math.max(0, Math.min(slideCount - 1, i));
      track.style.transition = animate ? 'transform 240ms ease' : 'none';
      track.style.transform = `translateX(${-mapIndex * 100}%)`;
      badge.textContent = `${mapIndex + 1} / ${slideCount}`;
      dots.forEach((d, idx) => d.classList.toggle('active', idx === mapIndex));
    };

    const openViewer = () => {
      viewer.classList.add('show');
      document.body.style.overflow = 'hidden';
      setMapIndex(0, false);
    };
    const closeViewerFn = () => {
      viewer.classList.remove('show');
      document.body.style.overflow = '';
    };

    mapBtn.addEventListener('click', openViewer);
    closeViewer.addEventListener('click', closeViewerFn);

    const activePointers = new Map();
    let startX = 0, dx = 0, swiping = false;
    const vw = () => Math.max(1, window.innerWidth || 375);

    track.addEventListener('pointerdown', (e) => {
      if (!viewer.classList.contains('show')) return;
      activePointers.set(e.pointerId, { x: e.clientX, y: e.clientY });
      if (activePointers.size === 1) {
        swiping = true; startX = e.clientX; dx = 0;
        track.style.transition = 'none';
      } else {
        swiping = false;
      }
      track.setPointerCapture(e.pointerId);
    });

    track.addEventListener('pointermove', (e) => {
      if (!activePointers.has(e.pointerId)) return;
      activePointers.set(e.pointerId, { x: e.clientX, y: e.clientY });
      if (!swiping || activePointers.size !== 1) return;
      dx = e.clientX - startX;
      const base = -mapIndex * vw();
      track.style.transform = `translateX(${base + dx}px)`;
    });

    const endSwipe = () => {
      if (!swiping) return;
      swiping = false;
      const threshold = Math.min(90, vw() * 0.22);
      if (dx > threshold) setMapIndex(mapIndex - 1, true);
      else if (dx < -threshold) setMapIndex(mapIndex + 1, true);
      else setMapIndex(mapIndex, true);
      dx = 0;
    };

    const onPointerUpOrCancel = (e) => {
      if (activePointers.has(e.pointerId)) activePointers.delete(e.pointerId);
      if (activePointers.size === 0) endSwipe();
      if (activePointers.size === 1) swiping = false;
    };

    track.addEventListener('pointerup', onPointerUpOrCancel);
    track.addEventListener('pointercancel', onPointerUpOrCancel);
    setMapIndex(0, false);

    /* ---------- Load screen logic ---------- */
    const aircraftSelect = document.getElementById('aircraftSelect');
    const loadTbody = document.getElementById('loadTbody');
    const loadRefreshBtn = document.getElementById('loadRefreshBtn');
    const homeBtn = document.getElementById('homeBtn');
    const totalText = document.getElementById('totalText');

    const aircraftData = [
      { name: "A350-900", classes: { C: 32, W: 21, Y: 259 } },
      { name: "A350-900 ULR", classes: { C: 32, W: 21, Y: 238 } },
      { name: "A380 Two Class", classes: { C: 58, Y: 557 } },
      { name: "A380 Three Class Medium Range", classes: { F: 14, C: 76, Y: [427, 429] } },
      { name: "A380 Three Class Long Range", classes: { F: 14, C: 76, Y: [399, 401] } },
      { name: "A380 Four Class", classes: { F: 14, C: 76, W: 56, Y: [322, 338, 341] } },
      { name: "B777-200LR", classes: { C: 38, Y: 264 } },
      { name: "B777-300ER Two Class", classes: { C: 35, Y: 386 } },
      { name: "B777-300ER Three Class", classes: { F: 8, C: 42, Y: [304, 310] } },
      { name: "B777-300ER Four Class", classes: { F: 8, C: 42, W: 24, Y: [256, 260] } },
      { name: "B777-300ER Game Changer", classes: { F: 6, C: 40, W: 24, Y: 256 } }
    ];

    const classOrder = ["F","C","W","Y"];
    const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const pickCap = (v) => Array.isArray(v) ? v[randInt(0, v.length - 1)] : v;

    const TARGET_MEAN = { F: 0.50, C: 0.75, W: 0.60, Y: 0.85 };
    const FULL_CHANCE = { C: 0.10, Y: 0.15 };
    const CONCENTRATION = 10;

    const randn = () => {
      let u = 0, v = 0;
      while (u === 0) u = Math.random();
      while (v === 0) v = Math.random();
      return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
    };

    const gammaSample = (shape) => {
      if (shape < 1) return gammaSample(shape + 1) * Math.pow(Math.random(), 1 / shape);
      const d = shape - 1/3;
      const c = 1 / Math.sqrt(9 * d);
      while (true) {
        let x = randn();
        let v = 1 + c * x;
        if (v <= 0) continue;
        v = v * v * v;
        const u = Math.random();
        if (u < 1 - 0.0331 * (x * x) * (x * x)) return d * v;
        if (Math.log(u) < 0.5 * x * x + d * (1 - v + Math.log(v))) return d * v;
      }
    };

    const betaSample = (a, b) => {
      const x = gammaSample(a);
      const y = gammaSample(b);
      return x / (x + y);
    };

    const clamp01 = (x) => Math.min(0.999, Math.max(0.001, x));
    const sampleLoadWithFullChance = (cap, targetMean, pFull) => {
      const p = Math.max(0, Math.min(1, pFull || 0));
      if (cap > 0 && Math.random() < p) return cap;

      const t = clamp01(targetMean);
      const denom = (1 - p);
      let mBase = denom <= 0 ? 0.999 : (t - p) / denom;
      mBase = clamp01(Math.max(0, mBase));

      const a = mBase * CONCENTRATION;
      const b = (1 - mBase) * CONCENTRATION;

      const frac = betaSample(a, b);
      const seats = Math.round(frac * cap);
      return Math.max(0, Math.min(cap, seats));
    };

    const fmtPct = (x) => `${(Math.round(x * 10) / 10).toFixed(1)}%`;

    const renderLoad = () => {
      const idx = aircraftSelect.selectedIndex;
      const aircraft = aircraftData[Math.max(0, idx)];
      if (!aircraft) return;

      const caps = {};
      for (const k of Object.keys(aircraft.classes)) caps[k] = pickCap(aircraft.classes[k]);

      const loads = {};
      for (const k of Object.keys(caps)) {
        const mean = TARGET_MEAN[k] ?? 0.7;
        const pFull = FULL_CHANCE[k] ?? 0;
        loads[k] = sampleLoadWithFullChance(caps[k], mean, pFull);
      }

      loadTbody.innerHTML = "";
      for (const cls of classOrder) {
        if (!(cls in caps)) continue;

        const tr = document.createElement("tr");
        if (cls === "F") tr.classList.add("rowF");
        if (cls === "C") tr.classList.add("rowC");
        if (cls === "W") tr.classList.add("rowW");
        if (cls === "Y") tr.classList.add("rowY");

        const td1 = document.createElement("td");
        const td2 = document.createElement("td");

        td1.classList.add("clsCell");  // 클래스 굵게
        td1.textContent = cls;
        td2.textContent = `${loads[cls]} / ${caps[cls]}`;

        tr.appendChild(td1);
        tr.appendChild(td2);
        loadTbody.appendChild(tr);
      }

      const totalLoad = Object.keys(loads).reduce((s,k)=>s+loads[k], 0);
      const totalCap  = Object.keys(caps).reduce((s,k)=>s+caps[k], 0);
      const occ = totalCap > 0 ? (totalLoad / totalCap) : 0;

      totalText.textContent = `${totalLoad} / ${totalCap} (${fmtPct(occ * 100)})`;
    };

    const initAircraftSelect = () => {
      aircraftSelect.innerHTML = "";
      for (const a of aircraftData) {
        const opt = document.createElement("option");
        opt.value = a.name;
        opt.textContent = a.name;
        aircraftSelect.appendChild(opt);
      }
      aircraftSelect.selectedIndex = 0;
      renderLoad();
    };

    addPressFeedback(loadRefreshBtn);
    addPressFeedback(homeBtn);

    aircraftSelect.addEventListener("change", renderLoad);
    loadRefreshBtn.addEventListener("click", renderLoad);
    homeBtn.addEventListener("click", () => showScreen('main'));

    loadBtn.addEventListener("click", () => {
      showScreen('load');
      if (aircraftSelect.options.length === 0) initAircraftSelect();
      else renderLoad();
    });
  </script>
</body>
</html>
